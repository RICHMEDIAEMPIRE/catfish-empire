<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Catfish Empire‚Ñ¢ Showcase</title>
  <style>
    body {
      background: black;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .toolbar {
      background: gold;
      color: black;
      font-weight: bold;
      padding: 0.75rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .toolbar-title {
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 0.25rem;
    }

    .toolbar-links {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 1000px;
    }

    .toolbar-links a {
      color: black;
      text-decoration: none;
      font-weight: bold;
      padding: 0.3rem 0.5rem;
      background: black;
      color: gold;
      border-radius: 5px;
    }

    .toolbar-links a:hover {
      background: #222;
    }

    @media (min-width: 768px) {
      .toolbar {
        flex-direction: row;
        justify-content: space-between;
        padding: 1rem 5%;
      }

      .toolbar-title {
        font-size: 1.8rem;
        margin: 0 auto;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }

      .toolbar-links {
        justify-content: space-between;
        width: 100%;
        max-width: none;
        position: relative;
        z-index: 1;
      }

      .toolbar-links a:first-child {
        margin-left: 0;
      }

      .toolbar-links a:last-child {
        margin-right: 0;
      }
    }

    h1 {
      text-align: center;
      color: gold;
      margin: 1rem 0 0.5rem;
    }

    .description {
      text-align: center;
      max-width: 600px;
      margin: 0 auto 1.5rem;
      color: #ccc;
      font-size: 1.05rem;
    }

    .state-box {
      margin: 2rem auto;
      text-align: center;
      max-width: 300px;
    }

    .state-box select {
      padding: 0.5rem;
      width: 100%;
    }

    .state-box .warning {
      color: red;
      font-weight: bold;
      display: none;
      margin-top: 0.5rem;
    }

    .product-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2rem;
      margin: 1rem;
    }

    .product {
      background: #222;
      padding: 1rem;
      border-radius: 10px;
      width: 200px;
      text-align: center;
    }

    .product img {
      width: 100%;
      border-radius: 10px;
      cursor: pointer;
    }

    .product input {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
    }

    .product button {
      background: gold;
      color: black;
      border: none;
      padding: 0.75rem;
      margin-top: 0.5rem;
      width: 100%;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
    }

    .viewer {
      display: none;
      position: fixed;
      top:0;
      left:0;
      width:100vw;
      height:100vh;
      background:rgba(0,0,0,0.95);
      align-items:center;
      justify-content:center;
      z-index:999;
    }

    .viewer img {
      max-width:90vw;
      max-height:90vh;
      border-radius:10px;
    }

    .nav-button {
      position: fixed;
      top:50%;
      transform:translateY(-50%);
      font-size:3rem;
      color:gold;
      background:none;
      border:none;
      cursor:pointer;
      z-index:1000;
    }

    .prev {
      left:10px;
    }

    .next {
      right:10px;
    }

    .close-btn {
      position: fixed;
      top:20px;
      right:20px;
      font-size:1.2rem;
      background: gold;
      color:black;
      border:none;
      padding:10px 20px;
      border-radius:5px;
      cursor:pointer;
      z-index:1000;
    }

    .etsy-footer {
      margin: 3rem auto 2rem;
      max-width: 500px;
      background: #222;
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
    }

    .etsy-footer img {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .etsy-footer .button {
      background: gold;
      color: black;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      font-size: 1.1rem;
      display: inline-block;
      transition: background 0.3s;
    }

    .etsy-footer .button:hover {
      background: #ffd700;
    }
  </style>
</head>
<body>

<div class="toolbar">
  <div class="toolbar-title">CATFISH EMPIRE‚Ñ¢ SHOP</div>
  <div class="toolbar-links">
    <a href="index.html">‚Üê Back</a>
    <a href="cart.html" class="cart-link">View Cart</a>
  </div>
</div>

<h1>Catfish Empire‚Ñ¢ Sunglasses ‚Ä¢ $14.99 + Tax</h1>
<p class="description">Stay sharp on the water with Catfish Empire‚Ñ¢ HD Polarized Sunglasses, crafted for serious anglers. These ultra-lightweight shades feature:
Polarized lenses for maximum glare reduction and crystal-clear vision.
UV400 protection to block 100% of harmful UVA & UVB rays.
Comfort-fit design that stays put‚Äîeven in rough conditions.
Built to see through the water, not just across it‚Äîthese are your go-to sunglasses for spotting structure, bait, and big catfish below the surface.</p>

<!-- STATE SELECTION -->
<div class="state-box">
  <label for="shipping-state">Select Your Shipping State:</label>
  <select id="shipping-state">
    <option value="">Select a state</option>
    <script>
      const blockedStates = ['CO', 'PA', 'CA'];
      const allStates = [
        'AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME',
        'MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR',
        'PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'
      ];
      allStates.forEach(state => {
        if (!blockedStates.includes(state)) {
          document.write(`<option value="${state}">${state}</option>`);
        }
      });
    </script>
  </select>
  <div id="state-warning" class="warning">üö´ Sorry, we do not ship to Colorado, California, or Pennsylvania.</div>
</div>

<div class="product-list" id="product-list"></div>

<div class="viewer" id="viewer">
  <button class="nav-button prev" onclick="changeImage(-1)">‚ùÆ</button>
  <img id="mainImage" src="" alt="Product Preview" />
  <button class="nav-button next" onclick="changeImage(1)">‚ùØ</button>
  <button class="close-btn" onclick="hideViewer()">Exit Fullscreen</button>
</div>

<div class="etsy-footer">
  <img src="shopbanner.jpg" alt="Etsy Shop" />
  <a href="https://www.etsy.com/shop/RICHMEDIAEMPIRE?ref=profile_header&sort_order=price_asc&section_id=54071039" target="_blank" class="button">Visit Our Etsy Shop</a>
</div>

<script>
const BACKEND_URL = "https://catfish-stripe-backend.onrender.com";
const products = [
  { color: "Blue", image: "sunglasses-blue.jpg" },
  { color: "Green", image: "sunglasses-green.jpg" },
  { color: "Red", image: "sunglasses-red.jpg" },
  { color: "Silver", image: "sunglasses-silver.jpg" },
  { color: "Black", image: "sunglasses-black.jpg" },
  { color: "Brown", image: "sunglasses-brown.jpg" }
];

let inventory = {}, cart = JSON.parse(localStorage.getItem("cart") || "[]");
let currentIndex = 0;

function updateLocalCart() {
  localStorage.setItem("cart", JSON.stringify(cart));
}

function updateCartCount() {
  const total = cart.reduce((sum, item) => sum + item.qty, 0);
  const cartLink = document.querySelector(".cart-link");
  if (cartLink) {
    cartLink.textContent = `View Cart (${total})`;
  }
}

function addToCart(color, qty) {
  if (!qty || qty < 1) return;
  if (inventory[color] === undefined || qty > inventory[color]) return alert(`Only ${inventory[color] || 0} in stock`);
  const exist = cart.find(i => i.color === color);
  if (exist) {
    if (exist.qty + qty > inventory[color]) return alert("Exceeds stock");
    exist.qty += qty;
  } else {
    cart.push({ color, qty });
  }
  updateLocalCart();
  updateCartCount();
  alert(`${qty}√ó ${color} added to cart`);
}

function handleAdd(color) {
  const qty = parseInt(document.getElementById(`qty-${color}`).value);
  const state = document.getElementById("shipping-state").value;
  const warning = document.getElementById("state-warning");

  if (!qty || qty < 1) return alert("Enter valid quantity");
  if (!state) return alert("Please select your shipping state first.");
  if (['CO','PA','CA'].includes(state)) {
    warning.style.display = "block";
    return;
  } else {
    warning.style.display = "none";
  }

  localStorage.setItem("shippingState", state);
  addToCart(color, qty);
}

function createProductCard(p) {
  const div = document.createElement("div");
  div.className = "product";
  div.innerHTML = `
    <img src="${p.image}" alt="${p.color}" onclick="openViewer(${products.findIndex(i => i.color === p.color)})" />
    <h3>${p.color}</h3>
    <p>In Stock: <span id="stock-${p.color}">‚Äì</span></p>
    <input type="number" min="1" value="1" id="qty-${p.color}" />
    <button onclick="handleAdd('${p.color}')">Add to Cart</button>
  `;
  return div;
}

function loadInventory() {
  fetch(`${BACKEND_URL}/public-inventory`)
    .then(r => r.json())
    .then(data => {
      inventory = data;
      const container = document.getElementById("product-list");
      container.innerHTML = "";
      products.forEach(p => {
        container.appendChild(createProductCard(p));
        document.getElementById(`stock-${p.color}`).textContent = inventory[p.color] ?? 0;
      });
    })
    .catch(err => {
      console.error("Failed to fetch inventory", err);
      document.getElementById("product-list").textContent = "Error loading inventory.";
    });
}

// Viewer logic
const viewer = document.getElementById("viewer");
const mainImage = document.getElementById("mainImage");

function openViewer(index) {
  currentIndex = index;
  viewer.style.display = "flex";
  showImage(currentIndex);
}

function showImage(index) {
  const p = products[index];
  if (!p) return;
  mainImage.src = p.image;
  mainImage.alt = p.color;
}

function changeImage(step) {
  currentIndex = (currentIndex + step + products.length) % products.length;
  showImage(currentIndex);
}

function hideViewer() {
  viewer.style.display = "none";
}

// Init
loadInventory();
updateCartCount();
</script>

</body>
</html>
